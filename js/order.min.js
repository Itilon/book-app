document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector(".main"),t=e.querySelector("form"),a=e.querySelectorAll("input"),n=e.querySelector("textarea"),s=e.querySelector(".piece-count"),l=e.querySelector(".price");t.addEventListener("submit",validateForm.bind(null,t)),a.forEach(e=>{"checkbox"!==e.type&&"number"!==e.type?(e.addEventListener("keydown",checkForErrorMessage.bind(null,e)),e.addEventListener("focusout",styleElementLabel.bind(null,e))):"checkbox"===e.type?e.addEventListener("click",checkForErrorMessage.bind(null,e)):(e.addEventListener("keyup",populateCountAndPriceFields.bind(null,e,s,l)),e.addEventListener("focusout",validateNumberInput.bind(null,e,s,l)))}),n.addEventListener("keydown",resizeTextarea.bind(null,n)),n.addEventListener("focusout",styleElementLabel.bind(null,n))});const validateForm=e=>{this.event.preventDefault(),e.checkValidity()?sendFormData(e).then(t=>{if(!t.ok)throw new Error;[...e.elements].forEach(e=>{"submit"!==e.type&&(e.classList.remove("valid"),e.labels[0].classList.remove("top-positioned"),"checkbox"!==e.type&&"number"!==e.type?e.value="":"checkbox"===e.type?e.checked=!1:e.value="1")}),populateFormMessage(e,!0)}).catch(()=>{[...e.elements].forEach(e=>{"submit"!==e.type&&(e.classList.remove("valid"),"checkbox"===e.type&&(e.checked=!1))}),populateFormMessage(e,!1)}):([...e.children].find(e=>e.classList.contains("success-message"))&&removeElement([...e.children].find(e=>e.classList.contains("success-message"))),[...e.elements].forEach(e=>{e.validity.valid||[...e.parentElement.children].find(e=>e.classList.contains("error-message"))||populateErrorMessage(e)}))},sendFormData=e=>{const t=e.action,a=e.method,n=new FormData(e),s={};return n.forEach((e,t)=>s[t]=e),fetch(t,{method:a,body:JSON.stringify(s),headers:{Accept:"application/json","Content-Type":"application/json"}})},populateFormMessage=(e,t)=>{const a=createElement("div",t?["success-message"]:["error-message"],null),n=createElement("i",t?["fa","fa-check"]:["fa","fa-exclamation-triangle"],null),s=createElement("p",null,t?"Поръчката ти е изпратена успешно.":"Нещо се обърка. Моля, опитай отново!"),l=createElement("span",["exit-btn"],"&#10005");a.appendChild(n),a.appendChild(s),a.appendChild(l),e.prepend(a),setTimeout(()=>{a.classList.add("show")},0),l.addEventListener("click",()=>removeElement(a))},populateErrorMessage=e=>{e.classList.add("invalid");const t=createElement("div",["error-message"],null),a=createElement("i",["fa","fa-exclamation-triangle"],null),n="checkbox"===e.type?createElement("p",null,"Моля, приеми условията на сайта!"):createElement("p",null,"Моля, попълни това поле правилно!"),s=createElement("span",["exit-btn"],"&#10005;");t.appendChild(a),t.appendChild(n),t.appendChild(s),e.parentElement.classList.contains("agreement")?e.parentElement.parentElement.appendChild(t):e.parentElement.appendChild(t),setTimeout(()=>{t.classList.add("show")},0),s.addEventListener("click",()=>removeElement(t))},checkForErrorMessage=e=>{const t=e.parentElement;"checkbox"!==e.type&&e.validity.valid&&[...t.children].find(e=>e.classList.contains("error-message"))?removeElement([...t.children].find(e=>e.classList.contains("error-message"))):e.validity.valid&&[...t.parentElement.children].find(e=>e.classList.contains("error-message"))&&removeElement([...t.parentElement.children].find(e=>e.classList.contains("error-message")))},resizeTextarea=e=>{e.style.height="auto",e.style.height=`${e.scrollHeight}px`},styleElementLabel=e=>{e.value?e.labels[0].classList.add("top-positioned"):e.labels[0].classList.contains("top-positioned")&&e.labels[0].classList.remove("top-positioned"),e.validity.valid?(e.classList.add("valid"),e.classList.contains("invalid")&&e.classList.remove("invalid")):(e.classList.add("invalid"),e.classList.contains("valid")&&e.classList.remove("valid"))},createElement=(e,t,a)=>{const n=document.createElement(e);return t&&n.classList.add(...t),n.innerHTML=a,n},removeElement=e=>{e.remove()},populateCountAndPriceFields=(e,t,a)=>{e.validity.valid?(e.classList.add("valid"),e.classList.remove("invalid"),t.innerText="1"===e.value?"бройка":"бройки",a.innerText=`${30*e.value}`):(e.classList.add("invalid"),e.classList.remove("valid"))},validateNumberInput=(e,t,a)=>{e.validity.valid||(e.classList.remove("invalid"),e.value="1",t.innerText="бройка",a.innerText="30")};